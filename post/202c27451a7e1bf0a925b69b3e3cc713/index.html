<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="theme-color" content="#202020"><meta http-equiv="x-ua-compatible" content="ie=edge"><title>同步日志到嘀咕 - 嘀咕</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.7.0/style.min.css"><link rel="stylesheet" href="/css/forever.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><meta name="generator" content="Hexo 7.1.1"></head><body><div class="wrap flex fd-c fai-c my-4 gap-4"><header class="flex fd-r fai-c fjc-sb mt-4 mb-8 gap-8"><div class="logo mb-1"><a class="flex px-2" href="/"><div class="draw"><div class="ghost"><div class="body"><div class="face"><div class="eyes"><span></span><span></span></div><div class="mouth"></div></div><div class="hands"> </div></div><div class="feet"><span></span><span></span><span></span><span></span></div></div></div><span class="name flex fjc-c fai-c">嘀咕</span></a></div><ul class="flex m-0 p-0 ta-c gap-6"><li><a href="/">首页</a></li><li><a href="/says">碎语</a></li><li><a href="/archives">归档</a></li><li><a href="/friends">朋友</a></li><li><a href="/about">关于</a></li></ul></header><main><article><div class="header flex fd-c fai-c"><h1 class="my-0">同步日志到嘀咕</h1><time datetime="2010-04-03T19:00:00.000Z">2010-04-04 03:00</time></div><div class="content mt-6"><p><a target="_blank" rel="noopener" href="http://www.digu.com/">嘀咕</a>，个人认为是继饭否之后国内最好的微博，本人一直在使用。</p>
<p>以前在 水煮鱼 的博客看到一篇文章<a target="_blank" rel="noopener" href="http://fairyfish.net/2009/11/22/wp-digu/">《同步 Wordpress 博客日志到嘀咕》</a>，当时使用的时候确实可以同步，可是现在不能同步了，应该说很长一段时间不能同步了。刚刚自己心血来潮，看了看水煮鱼的代码，然后打开<a target="_blank" rel="noopener" href="http://code.google.com/p/digu-api/wiki/DiguApi">嘀咕的API</a>，发现上面的发布消息地址不同，试了试把地址更换成API上的地址，结果同步成功。</p>
<p>下面把代码贴出来，自己做个记号，也方便大家查看。</p>
<div class="code-block mb-6"><div class="header px-4 py-3" data-language="php"><span></span><span></span><span></span></div><div class="body flex fd-r"><div class="line-numbers py-1 mx-3"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div><pre class="language-php m-0 mr-4 py-1" data-language="php"><code class="language-php p-0"><span class="token keyword">function</span> <span class="token function-definition function">update_digu</span><span class="token punctuation">(</span><span class="token variable">$status</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token constant">ABSPATH</span><span class="token operator">.</span><span class="token constant">WPINC</span><span class="token operator">.</span><span class="token string single-quoted-string">'/class-snoopy.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$snoop</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Snoopy</span><span class="token punctuation">;</span>
    <span class="token variable">$snoop</span><span class="token operator">-</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>user <span class="token operator">=</span> <span class="token string double-quoted-string">"你的嘀咕帐号"</span><span class="token punctuation">;</span>
    <span class="token variable">$snoop</span><span class="token operator">-</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>pass <span class="token operator">=</span> <span class="token string double-quoted-string">"你的嘀咕密码"</span><span class="token punctuation">;</span>
    <span class="token variable">$snoop</span><span class="token operator">-</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span><span class="token function">submit</span><span class="token punctuation">(</span>
        <span class="token string single-quoted-string">'http://api.minicloud.com.cn/statuses/update.format'</span>
        <span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span>
            <span class="token string single-quoted-string">'content'</span> <span class="token operator">=</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> <span class="token variable">$status</span>
        <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token function">add_action</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'publish_post'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'publish_post_digu'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function-definition function">publish_post_digu</span><span class="token punctuation">(</span><span class="token variable">$post_ID</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
    <span class="token variable">$digu</span> <span class="token operator">=</span> <span class="token function">get_post_meta</span><span class="token punctuation">(</span><span class="token variable">$post_ID</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'digu'</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$digu</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token variable">$status</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'post_title'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">' '</span><span class="token operator">.</span><span class="token function">get_permalink</span><span class="token punctuation">(</span><span class="token variable">$post_ID</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发送消息的样式</span>
    <span class="token function">update_digu</span><span class="token punctuation">(</span><span class="token variable">$status</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">add_post_meta</span><span class="token punctuation">(</span><span class="token variable">$post_ID</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'digu'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'true'</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></div></div>

<div class="code-block mb-6"><div class="header px-4 py-3" data-language="php"><span></span><span></span><span></span></div><div class="body flex fd-r"><div class="line-numbers py-1 mx-3"><span></span><span></span></div><pre class="language-php m-0 mr-4 py-1" data-language="php"><code class="language-php p-0"><span class="token comment">//我的发送消息样子是这样，和 狐滴 差不多。</span>
<span class="token variable">$status</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'我刚发布 [url='</span><span class="token operator">.</span><span class="token function">get_permalink</span><span class="token punctuation">(</span><span class="token variable">$post_ID</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">']'</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'post_title'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">'[/url]'</span><span class="token punctuation">;</span></code></pre></div></div>

<p>版权归<a target="_blank" rel="noopener" href="http://fairyfish.net/">水煮鱼</a>所有，与我无关，我的嘀咕是<a target="_blank" rel="noopener" href="http://digu.com/binjoo">@binjoo</a>，欢迎大家 Follow 。</p>
</div></article><div class="end flex fai-c fjc-c mb-4"><span class="flex fai-c fjc-c my-4 o2">THE-END</span></div><div class="tags my-4"><ul class="flex fjc-c fd-r gap-4"><li><a class="py-1 px-4 flex fd-c fai-c" href="/tags/%E5%98%80%E5%92%95/"><span>嘀咕<sup>4</sup></span></a></li><li><a class="py-1 px-4 flex fd-c fai-c" href="/tags/wordpress/"><span>wordpress<sup>12</sup></span></a></li></ul></div><div class="near flex fjc-sb mb-4"><div class="prev"><a href="/post/13c6cb91b1a7d5fe50362a2dbe7b7fd8/" ref="prev"><div class="text fw-b">PREVIOUS</div><div class="name">豆瓣信息同步到嘀咕</div></a></div><div class="next"><a href="/post/5d055879d6937c6e105aaabe82a9573a/" ref="next"><div class="text">NEXT</div><div class="name">人生路</div></a></div></div><div class="comments"><div class="comment-items"><h2 class="pl-2">评论列表</h2><div class="not-found flex fai-c fjc-c">「此时无声胜有声」</div></div></div></main><footer class="flex fjc-c"><div class="copyright"><p>© 2007 - 现在 <a href="">嘀咕</a></p></div></footer><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script><script type="text/javascript" src="/js/forever.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery-lazyload@1.9.7/jquery.lazyload.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script></div></body></html>