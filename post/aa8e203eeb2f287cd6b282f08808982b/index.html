<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="theme-color" content="#202020"><meta http-equiv="x-ua-compatible" content="ie=edge"><title>获得腾讯微博的信息 - 嘀咕</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.7.0/style.min.css"><link rel="stylesheet" href="/css/forever.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><meta name="generator" content="Hexo 7.1.1"></head><body><div class="wrap flex fd-c fai-c my-4 gap-4"><header class="flex fd-r fai-c fjc-sb mt-4 mb-8 gap-8"><div class="logo mb-1"><a class="flex px-2" href="/"><div class="draw"><div class="ghost"><div class="body"><div class="face"><div class="eyes"><span></span><span></span></div><div class="mouth"></div></div><div class="hands"> </div></div><div class="feet"><span></span><span></span><span></span><span></span></div></div></div><span class="name flex fjc-c fai-c">嘀咕</span></a></div><ul class="flex m-0 p-0 ta-c gap-6"><li><a href="/">首页</a></li><li><a href="/says">碎语</a></li><li><a href="/archives">归档</a></li><li><a href="/friends">朋友</a></li><li><a href="/about">关于</a></li></ul></header><main><article><div class="header flex fd-c fai-c"><h1 class="my-0">获得腾讯微博的信息</h1><time datetime="2011-04-08T02:18:00.000Z">2011-04-08 10:18</time></div><div class="content mt-6"><p>熟悉我的人都知道我之前用的是<a target="_blank" rel="noopener" href="http://digu.com/binjoo">嘀咕</a>，但是自从嘀咕转型后就没怎么去用过了。现在以邪恶的企鹅微博为主，但是一直以来腾讯微博的调用是个麻烦事，它的<a target="_blank" rel="noopener" href="http://open.t.qq.com/apps/show/">微博秀</a>使用iframe标签来嵌入的，让人很蛋疼，不能去修改它的显示样式，完全不能和博客同风格。前段时间开放平台中放出了RSS和JSONP的地址，这样的话就能够订阅到最新的消息了。</p>
<p>开始告诉你们怎么折腾吧，首先你要有两个QQ，第一个是你当前用的，第二个随便什么都可以。然后用你第二个QQ去开通微博，收听你但前用的微博，注意，只能收听你自己一个，那些什么推荐收听的V都跳过。最后你再进入<a target="_blank" rel="noopener" href="http://open.t.qq.com/resource.php?i=3,3">这里</a>，获得JSONP的地址。下面给出关键的代码部分。</p>
<div class="code-block mb-6"><div class="header px-4 py-3" data-language="php"><span></span><span></span><span></span></div><div class="body flex fd-r"><div class="line-numbers py-1 mx-3"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div><pre class="language-php m-0 mr-4 py-1" data-language="php"><code class="language-php p-0"><span class="token keyword">function</span> <span class="token function-definition function">get_qq_mirco_blog_info</span><span class="token punctuation">(</span><span class="token variable">$format</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;a href="&#123;permalink&#125;">&#123;content&#125;&lt;/a>'</span><span class="token punctuation">,</span><span class="token variable">$num</span> <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$qqRSS</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'这里填写JSONP地址'</span><span class="token punctuation">;</span> <span class="token comment">//注意：是第二个QQ的JSONP地址</span>
    <span class="token variable">$contents</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$qqRSS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$str1</span> <span class="token operator">=</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$contents</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'['</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$str2</span> <span class="token operator">=</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$contents</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'],"fans":'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$json</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$contents</span><span class="token punctuation">,</span><span class="token variable">$str1</span><span class="token punctuation">,</span> <span class="token variable">$str2</span> <span class="token operator">-</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这个地方不知道是否通用</span>
    <span class="token variable">$json</span> <span class="token operator">=</span> <span class="token function">stripslashes</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$json</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">,</span> <span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&amp;</span>lt<span class="token punctuation">;</span><span class="token variable">$num</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">//内容</span>
        <span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"n月d日 H:i"</span><span class="token punctuation">,</span><span class="token variable">$json</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'timestamp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//时间</span>
        <span class="token variable">$permalink</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"http://t.qq.com/p/t/"</span><span class="token operator">.</span><span class="token variable">$json</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//链接</span>
        <span class="token variable">$form</span> <span class="token operator">=</span> <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'fromarea'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">//来源</span>
        <span class="token variable">$type</span> <span class="token operator">=</span> <span class="token function">get_qq_mirco_blog_type_info</span><span class="token punctuation">(</span><span class="token variable">$json</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//类型</span>
        <span class="token variable">$count</span> <span class="token operator">=</span> <span class="token variable">$json</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'count'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">//转载次数</span>
        <span class="token keyword">echo</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&#123;content&#125;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&#123;time&#125;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&#123;permalink&#125;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&#123;form&#125;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&#123;type&#125;'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&#123;count&#125;'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">,</span><span class="token variable">$time</span><span class="token punctuation">,</span><span class="token variable">$permalink</span><span class="token punctuation">,</span><span class="token variable">$form</span><span class="token punctuation">,</span><span class="token variable">$type</span><span class="token punctuation">,</span><span class="token variable">$count</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token variable">$format</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">function</span> <span class="token function-definition function">get_qq_mirco_blog_type_info</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>
      <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"转播: "</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>
      <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"私信: "</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token number">4</span><span class="token punctuation">:</span>
      <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"回复: "</span><span class="token punctuation">;</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></div></div>

<p>把这段代码放入<code>function.php</code>文件中，然后在模板中调用代码<code>get_qq_mirco_blog_info();</code>。</p>
<p>该函数有两个参数，第一个是定义的格式，格式的参数请看for循环里面的注意；第二个是调用的条数，最多20条。</p>
<p>具体的调用代码就是这样了，我没有单独的测试，反正在自己的博客中是没有问题的，效率上我也不能保证什么，但是至少是比民间的API快吧，还有什么问题请留言吧。另外再给出一个获得RSS版的代码。</p>
<div class="code-block mb-6"><div class="header px-4 py-3" data-language="php"><span></span><span></span><span></span></div><div class="body flex fd-r"><div class="line-numbers py-1 mx-3"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div><pre class="language-php m-0 mr-4 py-1" data-language="php"><code class="language-php p-0"><span class="token variable">$qqRSS</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'RSS地址'</span><span class="token punctuation">;</span>
<span class="token variable">$XML</span> <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DomDocument</span><span class="token punctuation">;</span>
<span class="token variable">$XML</span><span class="token operator">-></span><span class="token function">load</span><span class="token punctuation">(</span><span class="token variable">$qqRSS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$Items</span> <span class="token operator">=</span> <span class="token variable">$XML</span><span class="token operator">-></span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"item"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"&lt;ul>
  "</span><span class="token punctuation">;</span>
  <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$Items</span> <span class="token keyword">as</span> <span class="token variable">$Item</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
      <span class="token variable">$title</span> <span class="token operator">=</span> <span class="token variable">$Item</span><span class="token operator">-></span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"title"</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token property">nodeValue</span><span class="token punctuation">;</span>  <span class="token comment">//内容</span>
      <span class="token variable">$link</span> <span class="token operator">=</span> <span class="token variable">$Item</span><span class="token operator">-></span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"link"</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token property">nodeValue</span><span class="token punctuation">;</span>  <span class="token comment">//链接</span>
      <span class="token variable">$time</span> <span class="token operator">=</span> <span class="token variable">$Item</span><span class="token operator">-></span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"pubDate"</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token property">nodeValue</span><span class="token punctuation">;</span>  <span class="token comment">//发布时间</span>
      <span class="token variable">$times</span> <span class="token operator">=</span> <span class="token function">time_tran</span><span class="token punctuation">(</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Y-m-d H:i:s"</span><span class="token punctuation">,</span><span class="token function">strtotime</span><span class="token punctuation">(</span><span class="token variable">$time</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//发布时间</span>
      <span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;li>
    &lt;div class="top">
      '</span><span class="token operator">.</span><span class="token variable">$title</span><span class="token operator">.</span><span class="token string single-quoted-string">'
    &lt;/div>
    
    &lt;div class="bottom">
      &lt;a target="_blank" href="'</span><span class="token operator">.</span><span class="token variable">$link</span><span class="token operator">.</span><span class="token string single-quoted-string">'">'</span><span class="token operator">.</span><span class="token variable">$times</span><span class="token operator">.</span><span class="token string single-quoted-string">'&lt;/a>
    &lt;/div>
  &lt;/li>'</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"
&lt;/ul>"</span><span class="token punctuation">;</span></code></pre></div></div>

<p>我的腾讯微博，欢迎收听我的微博：<a target="_blank" rel="noopener" href="http://t.qq.com/binjoo">@冰剑</a></p>
</div></article><div class="end flex fai-c fjc-c mb-4"><span class="flex fai-c fjc-c my-4 o2">THE-END</span></div><div class="tags my-4"><ul class="flex fjc-c fd-r gap-4"><li><a class="py-1 px-4 flex fd-c fai-c" href="/tags/%E7%BC%96%E7%A8%8B/"><span>编程<sup>2</sup></span></a></li></ul></div><div class="near flex fjc-sb mb-4"><div class="prev"><a href="/post/92bcbf0eaf7d3e9f40f5ace09353c69f/" ref="prev"><div class="text fw-b">PREVIOUS</div><div class="name">水榜之血条</div></a></div><div class="next"><a href="/post/f1f5778feb11043741b51848c71ef734/" ref="next"><div class="text">NEXT</div><div class="name">这几天的小折腾</div></a></div></div><div class="comments"><div class="comment-items"><h2 class="pl-2">评论列表</h2><div class="not-found flex fai-c fjc-c">「此时无声胜有声」</div></div></div></main><footer class="flex fjc-c"><div class="copyright"><p>© 2007 - 现在 <a href="">嘀咕</a></p></div></footer><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script><script type="text/javascript" src="/js/forever.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery-lazyload@1.9.7/jquery.lazyload.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script></div></body></html>