<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="theme-color" content="#202020"><meta http-equiv="x-ua-compatible" content="ie=edge"><title>水榜之血条 - 嘀咕</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.7.0/style.min.css"><link rel="stylesheet" href="/css/forever.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><meta name="generator" content="Hexo 7.1.1"></head><body><div class="wrap flex fd-c fai-c my-4 gap-4"><header class="flex fd-r fai-c fjc-sb mt-4 mb-8 gap-8"><div class="logo mb-1"><a class="flex px-2" href="/"><div class="draw"><div class="ghost"><div class="body"><div class="face"><div class="eyes"><span></span><span></span></div><div class="mouth"></div></div><div class="hands"> </div></div><div class="feet"><span></span><span></span><span></span><span></span></div></div></div><span class="name flex fjc-c fai-c">嘀咕</span></a></div><ul class="flex m-0 p-0 ta-c gap-6"><li><a href="/">首页</a></li><li><a href="/says">碎语</a></li><li><a href="/archives">归档</a></li><li><a href="/friends">朋友</a></li><li><a href="/about">关于</a></li></ul></header><main><article><div class="header flex fd-c fai-c"><h1 class="my-0">水榜之血条</h1><time datetime="2011-04-15T07:51:00.000Z">2011-04-15 15:51</time></div><div class="content mt-6"><p>什么是水榜呢？水榜就是以前的读者墙啦，因为读者墙是三个字，感觉在导航菜单里很不河蟹，所以改名叫水墙。血条是什么呢？这个这个，我也不知道怎么描述，大家看下图就明白什么是血条了。</p>
<p>血条怎么是蓝色的？也对哦，用网游的用于应该是魔法值。管他呢，血条、魔法值随便啦，你们懂就行了。最初看到这个创意是在<a target="_blank" rel="noopener" href="http://meapo.net/">@无冷</a>的博客里，请<a target="_blank" rel="noopener" href="http://meapo.net/links">点击这里</a>进行围观，他是用JS实现的，而我的是PHP实现。（@无冷 的博客还好多好玩的，主题新颖、ajax翻页、下一页预加载，好多好多，到时候发现喜欢的就copy过来，哇哈哈。）</p>
<p>首先把下面这段代码函数加入到你主题下的function.php文件中。</p>
<div class="code-block mb-6"><div class="header px-4 py-3" data-language="php"><span></span><span></span><span></span></div><div class="body flex fd-r"><div class="line-numbers py-1 mx-3"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div><pre class="language-php m-0 mr-4 py-1" data-language="php"><code class="language-php p-0"><span class="token keyword">function</span> <span class="token function-definition function">get_most_active_friends</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$db</span> <span class="token operator">=</span> <span class="token class-name static-context">Typecho_Db</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'COUNT(author) AS cnt'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'author'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'url'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'mail'</span><span class="token punctuation">)</span>
        <span class="token operator">-></span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'table.comments'</span><span class="token punctuation">)</span>
        <span class="token operator">-></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'status = ?'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'approved'</span><span class="token punctuation">)</span>
        <span class="token operator">-></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'type = ?'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'comment'</span><span class="token punctuation">)</span>
        <span class="token operator">-></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'authorId = ?'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'0'</span><span class="token punctuation">)</span>
        <span class="token operator">-></span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'mail != ?'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'icesword28@qq.com'</span><span class="token punctuation">)</span>
        <span class="token operator">-></span><span class="token function">group</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'author'</span><span class="token punctuation">)</span>
        <span class="token operator">-></span><span class="token function">order</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'cnt'</span><span class="token punctuation">,</span> <span class="token class-name static-context">Typecho_Db</span><span class="token operator">::</span><span class="token constant">SORT_DESC</span><span class="token punctuation">)</span>
        <span class="token operator">-></span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token string single-quoted-string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这里面填写读取前几位用户</span>
    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-></span><span class="token function">fetchAll</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$mostactive</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>
    <span class="token variable">$option</span> <span class="token operator">=</span> <span class="token class-name static-context">Typecho_Widget</span><span class="token operator">::</span><span class="token function">widget</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Widget_Options'</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">plugin</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'GravatarCache'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$maxNum</span> <span class="token operator">=</span> <span class="token variable">$result</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cnt'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$result</span> <span class="token keyword">as</span> <span class="token variable">$one</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token variable">$width</span> <span class="token operator">=</span> <span class="token function">round</span><span class="token punctuation">(</span><span class="token number">36</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token variable">$maxNum</span> <span class="token operator">/</span> <span class="token variable">$one</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cnt'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这里是血条长度的计算公式</span>
        <span class="token variable">$mostactive</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;li title="'</span><span class="token operator">.</span><span class="token variable">$one</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'author'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">'＠'</span><span class="token operator">.</span><span class="token variable">$one</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'cnt'</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string single-quoted-string">'">
  '</span><span class="token punctuation">;</span>
          <span class="token variable">$mostactive</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'&lt;div class="imgactive">
    &lt;img class="avatar" src="/usr/cache/avatar/'</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$option</span><span class="token operator">-></span><span class="token property">dir</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$one</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'mail'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token string single-quoted-string">'.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> 
            <span class="token variable">$mostactive</span> <span class="token operator">.=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$one</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'mail'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
            <span class="token variable">$mostactive</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'default'</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token variable">$mostactive</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'.jpg" />
  &lt;/div>'</span><span class="token punctuation">;</span>
          <span class="token variable">$mostactive</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">'
  
  &lt;div class="bgactive">
    &lt;div class="degreeactive" style="width:'</span><span class="token operator">.</span><span class="token variable">$width</span><span class="token operator">.</span><span class="token string single-quoted-string">'px">
      
    &lt;/div>
  &lt;/div>
&lt;/li>'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">echo</span> <span class="token variable">$mostactive</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code></pre></div></div>

<p>值得注意的是我用到了<a target="_blank" rel="noopener" href="http://www.byends.com/">@羽飞</a>的<a target="_blank" rel="noopener" href="http://www.byends.com/study/GravatarCache.html">Gravatar头像缓存插件</a>，没有用到这个插件的你们就把img标签这一段的代码修改为其他的获取方式吧。</p>
<p>血条计算公式方面，我当前所用的公式是，以评论数最多的人为满血状态，当然，你们也可以改成100为满血，这个随意啦。下面是CSS样式部分。</p>
<div class="code-block mb-6"><div class="header px-4 py-3" data-language="css"><span></span><span></span><span></span></div><div class="body flex fd-r"><div class="line-numbers py-1 mx-3"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></div><pre class="language-css m-0 mr-4 py-1" data-language="css"><code class="language-css p-0"><span class="token selector">#content .mostactive li</span><span class="token punctuation">&#123;</span>
	<span class="token property">border</span><span class="token punctuation">:</span>1px solid #DFDFDF<span class="token punctuation">;</span>
	<span class="token property">border-radius</span><span class="token punctuation">:</span>2px 2px 2px 2px<span class="token punctuation">;</span>
	<span class="token property">float</span><span class="token punctuation">:</span>left<span class="token punctuation">;</span>
	<span class="token property">height</span><span class="token punctuation">:</span>42px<span class="token punctuation">;</span>
	<span class="token property">list-style</span><span class="token punctuation">:</span>none outside none<span class="token punctuation">;</span>
	<span class="token property">margin</span><span class="token punctuation">:</span>0 11px 11px 0<span class="token punctuation">;</span>
	<span class="token property">padding</span><span class="token punctuation">:</span>5px<span class="token punctuation">;</span>
	<span class="token property">width</span><span class="token punctuation">:</span>36px
<span class="token punctuation">&#125;</span>
<span class="token selector">#content .mostactive .imgactive,#content .mostactive .imgactive img</span><span class="token punctuation">&#123;</span>
	<span class="token property">display</span><span class="token punctuation">:</span>block<span class="token punctuation">;</span>
	<span class="token property">width</span><span class="token punctuation">:</span>36px<span class="token punctuation">;</span>
	<span class="token property">height</span><span class="token punctuation">:</span>36px
<span class="token punctuation">&#125;</span>
<span class="token selector">#content .mostactive .bgactive</span><span class="token punctuation">&#123;</span>
	<span class="token property">background</span><span class="token punctuation">:</span>none repeat scroll 0 0 #DFDFDF<span class="token punctuation">;</span>
	<span class="token property">height</span><span class="token punctuation">:</span>2px<span class="token punctuation">;</span>
	<span class="token property">margin-top</span><span class="token punctuation">:</span>5px<span class="token punctuation">;</span>
	<span class="token property">width</span><span class="token punctuation">:</span>36px
<span class="token punctuation">&#125;</span>
<span class="token selector">#content .mostactive .degreeactive</span><span class="token punctuation">&#123;</span>
	<span class="token property">background</span><span class="token punctuation">:</span>none repeat scroll 0 0 #1E5494<span class="token punctuation">;</span>
	<span class="token property">height</span><span class="token punctuation">:</span>2px<span class="token punctuation">;</span>
	<span class="token property">width</span><span class="token punctuation">:</span>36px
<span class="token punctuation">&#125;</span></code></pre></div></div>

<p>最后大家在把这段代码<code>&lt;?php get_most_active_friends();?&gt;</code>找地方贴入调用就行了。</p>
<p>至此，大功告成，如有问题，请留言，技术有限，能帮尽量帮。</p>
</div></article><div class="end flex fai-c fjc-c mb-4"><span class="flex fai-c fjc-c my-4 o2">THE-END</span></div><div class="tags my-4"><ul class="flex fjc-c fd-r gap-4"><li><a class="py-1 px-4 flex fd-c fai-c" href="/tags/%E6%B0%B4%E6%A6%9C/"><span>水榜<sup>1</sup></span></a></li><li><a class="py-1 px-4 flex fd-c fai-c" href="/tags/%E8%AF%BB%E8%80%85/"><span>读者<sup>1</sup></span></a></li><li><a class="py-1 px-4 flex fd-c fai-c" href="/tags/%E8%A1%80%E6%9D%A1/"><span>血条<sup>1</sup></span></a></li></ul></div><div class="near flex fjc-sb mb-4"><div class="prev"><a href="/post/840315aeef94c7a6b065781471e909c2/" ref="prev"><div class="text fw-b">PREVIOUS</div><div class="name">分享下我的杀个花</div></a></div><div class="next"><a href="/post/aa8e203eeb2f287cd6b282f08808982b/" ref="next"><div class="text">NEXT</div><div class="name">获得腾讯微博的信息</div></a></div></div><div class="comments"><div class="comment-items"><h2 class="pl-2">评论列表</h2><div class="not-found flex fai-c fjc-c">「此时无声胜有声」</div></div></div></main><footer class="flex fjc-c"><div class="copyright"><p>© 2007 - 现在 <a href="">嘀咕</a></p></div></footer><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script><script type="text/javascript" src="/js/forever.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery-lazyload@1.9.7/jquery.lazyload.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script></div></body></html>