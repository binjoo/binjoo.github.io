<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="theme-color" content="#202020"><meta http-equiv="x-ua-compatible" content="ie=edge"><title>部署独立统计分析服务Umami - 嘀咕</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.7.0/style.min.css"><link rel="stylesheet" href="/css/forever.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><meta name="generator" content="Hexo 7.1.1"></head><body><div class="wrap flex fd-c fai-c my-4 gap-4"><header class="flex fd-r fai-c fjc-sb mt-4 mb-8 gap-8"><div class="logo mb-1"><a class="flex px-2" href="/"><div class="draw"><div class="ghost"><div class="body"><div class="face"><div class="eyes"><span></span><span></span></div><div class="mouth"></div></div><div class="hands"> </div></div><div class="feet"><span></span><span></span><span></span><span></span></div></div></div><span class="name flex fjc-c fai-c">嘀咕</span></a></div><ul class="flex m-0 p-0 ta-c gap-6"><li><a href="/">首页</a></li><li><a href="/says">碎语</a></li><li><a href="/archives">归档</a></li><li><a href="/friends">朋友</a></li><li><a href="/about">关于</a></li></ul></header><main><article><div class="header flex fd-c fai-c"><h1 class="my-0">部署独立统计分析服务Umami</h1><time datetime="2022-05-15T06:00:00.000Z">2022-05-15 14:00</time></div><div class="content mt-6"><p>在国内互联网初期，网站统计分析工具是五花八门，对于所有站长来说也并不陌生。Google Analytics应该也是当今互联网中使用最为广泛的统计分析工具。但是它在国内因为不可抗力的原因，使用起来并不方便，取而代之的是百度统计、CNZZ、51la三分天下的情形。统计分析工具可以通过在网页中嵌入追踪代码，来帮我们收集流量来源，分析转化率、跳出率等重要指标。</p>
<p>第三方网站统计分析工具功能虽然强大，也能够满足大部分站长的需求，但因为树大招风，这类工具的嵌入脚本基本都被各类去广告软件盯得死死的，完全不能发挥出应有的作用。<a target="_blank" rel="noopener" href="https://umami.is/">Umami</a>可以当作是Google Analytics的精简版的解决方案，它免费且开源，非常适合中小型网站的统计分析。正因为掌握在自己手上，用于应对去广告软件自然不在话下。</p>
<ul class="gallery gallery-1 gap-1"><li><a class="image" target="_blank" rel="noopener" href="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/43b242a49b0241b4b05a12946d50c81a.jpg!style:original" data-fancybox="gallery" data-caption="Umami官方展示数据"><img class="lazy br-1" data-original="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/43b242a49b0241b4b05a12946d50c81a.jpg!style:definition" src="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/43b242a49b0241b4b05a12946d50c81a.jpg!style:thumbnail" alt="Umami官方展示数据"></a></li></ul>

<h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><p>Umami支持MySQL和PostgreSQL数据库，选择自己喜欢的数据库进行数据初始化即可。下面是几个免费的数据库服务，这里选择的是<em>ElephantSQL</em>，当然，并不限于这些。</p>
<ul>
<li>MySQL：<a target="_blank" rel="noopener" href="https://freedb.tech/">FREEDB.TECH</a>、<a target="_blank" rel="noopener" href="https://www.db4free.net/">db4free</a></li>
<li>PostgreSQL：<a target="_blank" rel="noopener" href="https://www.elephantsql.com/">ElephantSQL</a>、<a target="_blank" rel="noopener" href="https://supabase.com/">Supabase</a></li>
</ul>
<p>这里提供两种PostgreSQL的教程，二选一即可，大家反馈<strong>Supabase</strong>速度更快一些，所以推荐<strong>Supabase</strong>。</p>
<h3 id="Supabase"><a href="#Supabase" class="headerlink" title="Supabase"></a>Supabase</h3><p>打开<a target="_blank" rel="noopener" href="https://supabase.com/">Supabase</a>，推荐使用Github登录。登陆成功后，创建一个新的项目<em>New project-&gt;personal</em>。</p>
<ul>
<li>Name：随意</li>
<li>Database Password：建议点击<em>Generate a password</em>生成</li>
<li>Region：建议漂亮国，因为<em>Vercel</em>的免费服务器在漂亮国</li>
<li>Pricing Plan：Free白嫖</li>
</ul>
<p>创建成功后，打开菜单<em>Project Setting -&gt; Database -&gt; Connection string -&gt; URI</em>，如下图：</p>
<ul class="gallery gallery-1 gap-1"><li><a class="image" target="_blank" rel="noopener" href="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/5cbc0f84f1fd4c39928449ffe2e9d7ad.png!style:original" data-fancybox="gallery" data-caption="Supabase 数据库实例"><img class="lazy br-1" data-original="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/5cbc0f84f1fd4c39928449ffe2e9d7ad.png!style:definition" src="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/5cbc0f84f1fd4c39928449ffe2e9d7ad.png!style:thumbnail" alt="Supabase 数据库实例"></a></li></ul>

<p>找到URI<code>postgresql://postgres:[YOUR-PASSWORD]@db.abcdefghijklmnopqrstuvwxyz.supabase.co:5432/postgres</code>，其中<code>[YOUR-PASSWORD]</code>替换为密码，复制待用。</p>
<p>打开菜单<em>SQL Editor -&gt; New query</em>，执行<a target="_blank" rel="noopener" href="https://github.com/mikecao/umami/blob/master/sql/schema.postgresql.sql">数据库初始化脚本</a>。</p>
<h3 id="ElephantSQL"><a href="#ElephantSQL" class="headerlink" title="ElephantSQL"></a>ElephantSQL</h3><p>打开<a target="_blank" rel="noopener" href="https://www.elephantsql.com/">ElephantSQL</a>，推荐使用Github登录，创建一个新的实例。Plan选择<code>Tiny Turtle(Free)</code>、Region随意，提交创建。</p>
<ul class="gallery gallery-1 gap-1"><li><a class="image" target="_blank" rel="noopener" href="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/db1c2422f61742cb8ee27f3ca70d03d7.png!style:original" data-fancybox="gallery" data-caption="ElephantSQL 数据库实例"><img class="lazy br-1" data-original="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/db1c2422f61742cb8ee27f3ca70d03d7.png!style:definition" src="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/db1c2422f61742cb8ee27f3ca70d03d7.png!style:thumbnail" alt="ElephantSQL 数据库实例"></a></li></ul>

<p>打开刚刚创建的示例，找到URL<code>postgres://ydmeptjz:***@tiny.db.elephantsql.com/ydmeptjz</code>，复制待用。</p>
<p>打开实例的Browser页面，执行<a target="_blank" rel="noopener" href="https://github.com/mikecao/umami/blob/master/sql/schema.postgresql.sql">数据库初始化脚本</a>。</p>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>打开<a target="_blank" rel="noopener" href="https://www.vercel.com/">Vercel</a>，同样推荐使用Github登录，然后点击<a target="_blank" rel="noopener" href="https://vercel.com/new/git/external?repository-url=https://github.com/mikecao/umami&env=DATABASE_URL,HASH_SALT,TRACKER_SCRIPT_NAME&envDescription=These%20values%20are%20defined%20in%20the%20configure%20Umami%20step%20from%20Install&envLink=https://umami.is/docs/install&project-name=umami&repo-name=umami">这里</a>，用来Fork Umami项目。等待Fork创建完成后，需要配置三个环境变量：</p>
<ul>
<li>DATABASE_URL：粘贴上一步的数据库链接；</li>
<li>HASH_SALT：任意字符串，推荐<a target="_blank" rel="noopener" href="https://uuid.bmcx.com/">这里</a>生成一串UUID，不用记住；</li>
<li>TRACKER_SCRIPT_NAME：任意字符串，推荐<a target="_blank" rel="noopener" href="https://uuid.bmcx.com/">这里</a>生成一串UUID，需要记住；</li>
</ul>
<p>配置完成后点击<code>Deploy</code>开始部署，部署过程大概两分钟，部署成功后会有一个彩纸的喜庆页面。</p>
<ul class="gallery gallery-1 gap-1"><li><a class="image" target="_blank" rel="noopener" href="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/9eb12d186e9e448abe0e2fa214360553.png!style:original" data-fancybox="gallery" data-caption="部署成功"><img class="lazy br-1" data-original="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/9eb12d186e9e448abe0e2fa214360553.png!style:definition" src="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/9eb12d186e9e448abe0e2fa214360553.png!style:thumbnail" alt="部署成功"></a></li></ul>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>进入Vercel分配的网址登录，默认用户名<code>admin</code>和密码<code>umami</code>，进入后第一时间修改密码。</p>
<p>进入后台设置页面，创建一个新的站点，获得站的嵌入脚本。嵌入脚本中的<code>umima</code>.js替换为刚刚的环境变量<code>TRACKER_SCRIPT_NAME</code>的值。这样的作用就是为了防止去广告插件把这段脚本给拦截。</p>
<ul class="gallery gallery-1 gap-1"><li><a class="image" target="_blank" rel="noopener" href="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/d2c9f05185624662b2517c70e2cfd6e1.png!style:original" data-fancybox="gallery" data-caption="嵌入脚本"><img class="lazy br-1" data-original="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/d2c9f05185624662b2517c70e2cfd6e1.png!style:definition" src="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/d2c9f05185624662b2517c70e2cfd6e1.png!style:thumbnail" alt="嵌入脚本"></a></li></ul>

<h2 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h2><p>全部完成后，刷新一下网站，就可以在后台看到访客的访问记录了，非常的简单方便，还有其他的配置和玩法大家可以查看<a target="_blank" rel="noopener" href="https://umami.is/docs">官方文档</a>。</p>
<ul class="gallery gallery-1 gap-1"><li><a class="image" target="_blank" rel="noopener" href="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/7247215db16745c9b6f42003910a4209.png!style:original" data-fancybox="gallery" data-caption="查看效果"><img class="lazy br-1" data-original="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/7247215db16745c9b6f42003910a4209.png!style:definition" src="https://digu-image-host.s3.bitiful.net/2022/05/8034746f42b3495fbb19926e3fb8ec4f/7247215db16745c9b6f42003910a4209.png!style:thumbnail" alt="查看效果"></a></li></ul>

</div></article><div class="end flex fai-c fjc-c mb-4"><span class="flex fai-c fjc-c my-4 o2">THE-END</span></div><div class="tags my-4"><ul class="flex fjc-c fd-r gap-4"><li><a class="py-1 px-4 flex fd-c fai-c" href="/tags/%E5%8D%9A%E5%AE%A2/"><span>博客<sup>24</sup></span></a></li><li><a class="py-1 px-4 flex fd-c fai-c" href="/tags/%E6%8A%98%E8%85%BE/"><span>折腾<sup>14</sup></span></a></li><li><a class="py-1 px-4 flex fd-c fai-c" href="/tags/Umami/"><span>Umami<sup>2</sup></span></a></li></ul></div><div class="near flex fjc-sb mb-4"><div class="prev"><a href="/post/ea542975b7ff4b68aef6f385ff28418f/" ref="prev"><div class="text fw-b">PREVIOUS</div><div class="name">记一次代位追偿的事故</div></a></div><div class="next"><a href="/post/9319422d809c4611a30dabab3e28e34d/" ref="next"><div class="text">NEXT</div><div class="name">时隔多年，再次捡起博客</div></a></div></div><div class="comments"><div class="comment-items"><h2 class="pl-2">评论列表</h2><div class="not-found flex fai-c fjc-c">「此时无声胜有声」</div></div></div></main><footer class="flex fjc-c"><div class="copyright"><p>© 2007 - 现在 <a href="">嘀咕</a></p></div></footer><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script><script type="text/javascript" src="/js/forever.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery-lazyload@1.9.7/jquery.lazyload.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script></div></body></html>