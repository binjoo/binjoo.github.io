<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="theme-color" content="#202020"><meta http-equiv="x-ua-compatible" content="ie=edge"><title>Umami 升级至 V2 - 嘀咕</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-webfont@1.7.0/style.min.css"><link rel="stylesheet" href="/css/forever.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><meta name="generator" content="Hexo 7.1.1"></head><body><div class="wrap flex fd-c fai-c my-4 gap-4"><header class="flex fd-r fai-c fjc-sb mt-4 mb-8 gap-8"><div class="logo mb-1"><a class="flex px-2" href="/"><div class="draw"><div class="ghost"><div class="body"><div class="face"><div class="eyes"><span></span><span></span></div><div class="mouth"></div></div><div class="hands"> </div></div><div class="feet"><span></span><span></span><span></span><span></span></div></div></div><span class="name flex fjc-c fai-c">嘀咕</span></a></div><ul class="flex m-0 p-0 ta-c gap-6"><li><a href="/">首页</a></li><li><a href="/says">碎语</a></li><li><a href="/archives">归档</a></li><li><a href="/friends">朋友</a></li><li><a href="/about">关于</a></li></ul></header><main><article><div class="header flex fd-c fai-c"><h1 class="my-0">Umami 升级至 V2</h1><time datetime="2023-05-06T13:41:00.000Z">2023-05-06 21:41</time></div><div class="content mt-6"><p>摸鱼时发现 Umami 早在三周前发布了 v2 版本，于是乎赶紧跟上。</p>
<h2 id="更新数据库结构"><a href="#更新数据库结构" class="headerlink" title="更新数据库结构"></a>更新数据库结构</h2><p>因为 v1 和 v2 的数据库结构不同，所以需要对 v1 的数据库进行更新，具体操作如下：</p>
<h3 id="备份数据库"><a href="#备份数据库" class="headerlink" title="备份数据库"></a>备份数据库</h3><p>这个不必多说，数据是无价的，对数据库动刀前，请一定一定一定记得备份数据库、备份数据库、备份数据。</p>
<h3 id="升级数据库"><a href="#升级数据库" class="headerlink" title="升级数据库"></a>升级数据库</h3><div class="code-block mb-6"><div class="header px-4 py-3" data-language="bash"><span></span><span></span><span></span></div><div class="body flex fd-r"><div class="line-numbers py-1 mx-3"><span></span><span></span><span></span><span></span></div><pre class="language-bash m-0 mr-4 py-1" data-language="bash"><code class="language-bash p-0"><span class="token function">git</span> clone https://github.com/umami-software/migrate-v1-v2.git
<span class="token builtin class-name">cd</span> migrate-v1-v2
<span class="token function">yarn</span> <span class="token function">install</span>
<span class="token function">yarn</span> build</code></pre></div></div>

<p>在<em>migrate-v1-v2</em>根目录下创建<code>.env</code>文件，内容如下：</p>
<div class="code-block mb-6"><div class="header px-4 py-3" data-language="env"><span></span><span></span><span></span></div><div class="body flex fd-r"><div class="line-numbers py-1 mx-3"><span></span><span></span></div><pre class="language-env m-0 mr-4 py-1" data-language="env"><code class="language-env p-0"># &#123;connection url&#125;替换为环境变量中的值
DATABASE_URL&#x3D;&#123;connection url&#125;</code></pre></div></div>

<p>最后运行<code>yarn start</code>，看到如下内容表示正常结束。</p>
<ul class="gallery gallery-1 gap-1"><li><a class="image" target="_blank" rel="noopener" href="https://digu-image-host.s3.bitiful.net/2023/05/7ce6f41b86474427acede7935b7125dd/359c77e5676845eab67b6488efabab0c.png!style:original" data-fancybox="gallery"><img class="lazy br-1" data-original="https://digu-image-host.s3.bitiful.net/2023/05/7ce6f41b86474427acede7935b7125dd/359c77e5676845eab67b6488efabab0c.png!style:definition" src="https://digu-image-host.s3.bitiful.net/2023/05/7ce6f41b86474427acede7935b7125dd/359c77e5676845eab67b6488efabab0c.png!style:thumbnail" alt=""></a></li></ul>

<h2 id="更新-V2-代码"><a href="#更新-V2-代码" class="headerlink" title="更新 V2 代码"></a>更新 V2 代码</h2><p>从<a target="_blank" rel="noopener" href="https://github.com/umami-software/umami/releases">Umami Releases</a>中获得最新的发布版代码，提交至你的仓库中，等待 Vercel 自动部署即可。</p>
<p>更新代码时，请删除目录中所有文件（不含.git），然后再粘贴 V2 的代码。</p>
<h2 id="更换脚本"><a href="#更换脚本" class="headerlink" title="更换脚本"></a>更换脚本</h2><p>如果你使用的是默认脚本<code>umami.js</code>，则需要改为<code>script.js</code>，如果是自定义的，则需要把<code>.js</code>去掉。</p>
<h2 id="变化"><a href="#变化" class="headerlink" title="变化"></a>变化</h2><ul class="gallery gallery-1 gap-1"><li><a class="image" target="_blank" rel="noopener" href="https://digu-image-host.s3.bitiful.net/2023/05/7ce6f41b86474427acede7935b7125dd/b67cd54d141d4afea1de1822f939e974.png!style:original" data-fancybox="gallery"><img class="lazy br-1" data-original="https://digu-image-host.s3.bitiful.net/2023/05/7ce6f41b86474427acede7935b7125dd/b67cd54d141d4afea1de1822f939e974.png!style:definition" src="https://digu-image-host.s3.bitiful.net/2023/05/7ce6f41b86474427acede7935b7125dd/b67cd54d141d4afea1de1822f939e974.png!style:thumbnail" alt=""></a></li></ul>

<p>主要发现三个变化：</p>
<ol>
<li>UI变了，全屏铺开，并且中文字体看着比 V1 舒服太多太多，不知道是不是心理作用，感觉速度也略微快一些；</li>
<li>位置更加详细，V1 展示用户来源，仅仅只是再国家或地区这一级，而在 V2 中，可以展示省、市层级；</li>
<li>网页标题，以前只能看到网页URL，必须要打开网页才知道内容，现在可以直接显示标题。</li>
</ol>
<p>最后，开始享受船新的版本吧！</p>
</div></article><div class="end flex fai-c fjc-c mb-4"><span class="flex fai-c fjc-c my-4 o2">THE-END</span></div><div class="tags my-4"><ul class="flex fjc-c fd-r gap-4"><li><a class="py-1 px-4 flex fd-c fai-c" href="/tags/%E6%95%99%E7%A8%8B/"><span>教程<sup>2</sup></span></a></li><li><a class="py-1 px-4 flex fd-c fai-c" href="/tags/Umami/"><span>Umami<sup>2</sup></span></a></li></ul></div><div class="near flex fjc-sb mb-4"><div class="prev"><a href="/post/3d52235eab354093854880ee33de330a/" ref="prev"><div class="text fw-b">PREVIOUS</div><div class="name">开车路上真危险</div></a></div><div class="next"><a href="/post/3ec35c28824d4131be414958f34971f2/" ref="next"><div class="text">NEXT</div><div class="name">阿里云不给个人账户开企业发票</div></a></div></div><div class="comments"><div class="comment-items"><h2 class="pl-2">评论列表</h2><div class="not-found flex fai-c fjc-c">「此时无声胜有声」</div></div></div></main><footer class="flex fjc-c"><div class="copyright"><p>© 2007 - 现在 <a href="">嘀咕</a></p></div></footer><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script><script type="text/javascript" src="/js/forever.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/jquery-lazyload@1.9.7/jquery.lazyload.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script></div></body></html>